<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script>
		const prefix = window.location.pathname.replace(/\/{2,}/g, '/');
		const currentPath = window.location.pathname.replace(/\/{2,}/g, '/');
		const baseUrl = `http://localhost${currentPath}`;
		//alert(prefix); 
      </script>
    <title>Project roadmap</title>
</head>

<body>

    <div>
        <label for="step2">Step 2:</label>
    <input type="checkbox" id="step2" name="step2" onchange="updateProgressBar('step2')">
    </div>
    <h1>Project roadmap</h1>

    <button id="add" onClick=addNewVersion();>Add Version</button>
    <div id="versions-container"></div>
    

    <div class="parentro">
        <div class="divro1"> <h3><img src="./img/calendar.png" > DATE</h3>
            <p>The release date or timeframe</p></div>
        <div class="divro2"> <h3><img src="./img/etiquette.png" > NAME</h3>
            <p>The name of the new release</p></div>
        <div class="divro3"> <h3><img src="./img/cible.png" > GOAL</h3>
            <p>The benefit the product
                should offer</p></div>
        <div class="divro4"> <h3><img src="./img/star.png" > FEATURES</h3>
            <p>The high-level features
                necessary to meet the goal</p></div>
        <div class="divro5"> <h3><img src="./img/graph.png" > METRICS</h3>
            <p>The metrics to determine if the
                goal has been met</p></div>

        <div class="divro6"> Date or timeframe
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro7"> Name/version
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro8"> Goal
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro9"> Features
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro10"> Metrics
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro11"> Date or timeframe
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro12"> Name/version
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro13"> Goal
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro14"> Features
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro15"> Metrics
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro16"> Date or timeframe
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro17"> Name/version
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro18"> Goal
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro19"> Features
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro20"> Metrics
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro21"> Date or timeframe
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro22"> Name/version
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro23"> Goal
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro24"> Features
            <textarea rows="2" cols="15"></textarea>
        </div>
        <div class="divro25"> Metrics
            <textarea rows="2" cols="15"></textarea>
        </div>
        </div>
        
        
        

</body>
</html>
<script>
 
  // Define the increment value
  let incrementValue = 13; // Set the initial value
 //Change value with method selection
   let methoddev = localStorage.getItem("val");
 
     if(methoddev == "Kanban"){
       incrementValue = 33;
     }
  
 
   // Function to update the progress bar and save the value
   function updateProgressBar(stepId) {
     // Get the step checkbox by its ID
     const stepCheckbox = document.getElementById(stepId);
 
     // Check if the step checkbox element exists
     if (!stepCheckbox) {
       console.error("Step checkbox not found!");
       return;
     }
 
     // Calculate the progress increment
     const progressIncrement = stepCheckbox.checked ? incrementValue : -incrementValue;
 
     // Retrieve the overall progress value from localStorage
     const savedProgress = localStorage.getItem("progress");
     let overallProgress = 0;
 
     if (savedProgress && !isNaN(savedProgress)) {
       overallProgress = parseInt(savedProgress, 10);
     }
 
     // Update the overall progress by adding the current progress increment
     overallProgress += progressIncrement;
 
     // Save the overall progress value to localStorage
     localStorage.setItem("progress", overallProgress.toString());
 
     // Save the checked state of the step checkbox to localStorage
     localStorage.setItem(stepId, stepCheckbox.checked ? "checked" : "unchecked");
 
     // Update the width of the progress bar
     document.getElementById("myBar").style.width = overallProgress + "%";
   }
 
   // Check if progress value exists in localStorage on page load
   document.addEventListener("DOMContentLoaded", function() {
     // Retrieve the overall progress value from localStorage
     const savedProgress = localStorage.getItem("progress");
     let overallProgress = 0;
 
     if (savedProgress && !isNaN(savedProgress)) {
       overallProgress = parseInt(savedProgress, 10);
     }
 
     // Get the step checkbox by its ID
     const stepCheckbox = document.getElementById("step2");
 
     // Check if the step checkbox element exists
     if (!stepCheckbox) {
       console.error("Step checkbox not found!");
       return;
     }
 
     // Retrieve the checked state of the step checkbox from localStorage
     const savedCheckboxValue = localStorage.getItem("step2");
     if (savedCheckboxValue === "checked") {
       stepCheckbox.checked = true;
       overallProgress += incrementValue;
     } else {
       stepCheckbox.checked = false;
     }
 
     // Update the width of the progress bar with the overall progress value
     document.getElementById("myBar").style.width = overallProgress + "%";
   });
 </script>
<script>

    const versionsContainer = document.getElementById("versions-container");
    const versions = [];
    const names = ["DATE", "NAME", "GOAL", "FEATURES", "METRICS"];
  

    class Version {
    constructor(versionNumber, versionDate, inputValues, prefix) {
    this.versionNumber = versionNumber;
    this.versionDate = versionDate;
    this.inputValues = inputValues;
    this.element = this.createDiv(prefix);
    this.idPrefix = prefix;

    /*delete button*/
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";
    deleteBtn.addEventListener("click", () => {
      const index = versions.indexOf(this);
      if (index > -1) {
        versions.splice(index, 1);
      }
      this.element.remove();
      localStorage.setItem("versions", JSON.stringify(versions));
    });
    this.element.appendChild(deleteBtn);
  }

  /*for creating div*/
  createDiv() {
    const div = document.createElement("div");
    div.classList.add("version");
    div.innerHTML = `
      <h3>Version ${this.versionNumber}</h3>
      <p>Date: ${this.versionDate}</p>
    `;
    const inputContainer = document.createElement("div");
    inputContainer.classList.add("input-container");
    for (let i = 0; i < this.inputValues.length; i++) {
      const inputDiv = document.createElement("div");
      inputDiv.classList.add("input-div");
      const label = document.createElement("label");
      label.textContent = `${names[i]}:`;
      const input = document.createElement("input");
      input.setAttribute("type", "text");
      input.setAttribute("placeholder", `Input ${i + 1}`);
      input.value = this.inputValues[i];
      input.id = `${prefix}-input${i}-${this.versionNumber}`; // use prefix to prefix the id
      const updateButton = document.createElement("button");
      updateButton.classList.add("update");
      updateButton.textContent = "Update";
      updateButton.addEventListener("click", () => {
        this.inputValues[i] = input.value;
       
        localStorage.setItem(`version_${prefix}_${this.versionNumber}-input${i}`, input.value);
        this.printInputs(inputContainer);
      });
      inputDiv.appendChild(label);
      inputDiv.appendChild(input);
      inputDiv.appendChild(updateButton);
      inputContainer.appendChild(inputDiv);
    }
    div.appendChild(inputContainer);
    return div;
  }

  printInputs(container) {
    container.querySelectorAll("input").forEach((input, i) => {
      const inputValue = localStorage.getItem(`version_${prefix}_${this.versionNumber}-input${i}`) || "";
      input.value = inputValue;
      input.id=prefix+(i+1);
      const valueElement = document.createElement("span");
      valueElement.classList.add("value");
      valueElement.textContent = inputValue;
      input.nextElementSibling.innerHTML = "Value: ";
      input.nextElementSibling.appendChild(valueElement);
    });
  }
  
}


function loadDataFromLocalStorage() {
  const versionsData = JSON.parse(localStorage.getItem(`versions_${prefix}`)) || [];
  versionsData.forEach((versionData) => {
    const versionNumber = versionData.versionNumber;
    const versionDate = versionData.versionDate;
    const inputValues = versionData.inputValues;
    const version = new Version(versionNumber, versionDate, inputValues, prefix);
    versions.push(version);
    versionsContainer.appendChild(version.element);
    version.printInputs(version.element.querySelector(".input-container"));
  });
}


  

    function addNewVersion() {
  const versionNumber = versions.filter((v) => v.idPrefix === prefix).length + 1;
  const versionDate = new Date().toLocaleDateString();
  const inputValues = ["", "", "", "", ""];
  const version = new Version(versionNumber, versionDate, inputValues, prefix);
  versions.push(version);
  versionsContainer.appendChild(version.element);
  localStorage.setItem(`versions_`+prefix, JSON.stringify(versions.filter((v) => v.idPrefix === prefix)));
}
  
    window.onload = function() {
      loadDataFromLocalStorage();
    };
  </script>